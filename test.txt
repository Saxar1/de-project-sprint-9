export KUBECONFIG=/home/saxarok/Desktop/kubeconfig

в директории с service_stg
в директории с dockerfile
sudo docker build . -t cr.yandex/crpum2q4frc77dsas1qd/stg-service:v2023-10-15-r1
sudo docker push cr.yandex/crpum2q4frc77dsas1qd/stg-service:v2023-10-15-r1
helm upgrade --install --atomic stg-service app -n c14-stepan-starczev


ОБНОВЛЕНИЕ ДАННЫХ В REDIS

Загрузка пользователей в redis
curl -X POST https://redis-data-service.sprint9.tgcloudenv.ru/load_users \
-H 'Content-Type: application/json; charset=utf-8' \
--data-binary @- << EOF
{
    "redis":{
        "host": "c-c9qjjd6vk7jfnpjf23ao.rw.mdb.yandexcloud.net",
        "port": 6380,
        "password": "saxarok1"
    }
}
EOF

Загрузка ресторанов
curl -X POST https://redis-data-service.sprint9.tgcloudenv.ru/load_restaurants \
-H 'Content-Type: application/json; charset=utf-8' \
--data-binary @- << EOF
{
    "redis":{
        "host": "c-c9qjjd6vk7jfnpjf23ao.rw.mdb.yandexcloud.net",
        "port": 6380,
        "password": "saxarok1"
    }
}
EOF


ПЕРЕРЕГЕСТРИРОВАТЬ ТОПИК KAFKA

curl -X POST https://order-gen-service.sprint9.tgcloudenv.ru/delete_kafka \
-H 'Content-Type: application/json; charset=utf-8' \
--data-binary @- << EOF
{
    "student": "saxarok"
}
EOF

curl -X POST https://order-gen-service.sprint9.tgcloudenv.ru/register_kafka \
-H 'Content-Type: application/json; charset=utf-8' \
--data-binary @- << EOF
{
    "student": "saxarok",
    "kafka_connect":{
        "host": "rc1a-vnj01ua1un60cv7t.mdb.yandexcloud.net",
        "port": 9091,
        "topic": "order-service_orders",
        "producer_name": "producer_consumer",
        "producer_password": "saxarok1"
    }
}
EOF

ПОЛУЧИТЬ СООБЩЕНИЕ KAFKA:
kafkacat -C \
         -b rc1a-vnj01ua1un60cv7t.mdb.yandexcloud.net:9091 \
         -t stg-service-orders \
         -X security.protocol=SASL_SSL \
         -X sasl.mechanism=SCRAM-SHA-512 \
         -X sasl.username="producer_consumer" \
         -X sasl.password="saxarok1" \
         -X ssl.ca.location=/home/saxarok/Desktop/CA.pem -Z -K:


kafkacat -C \
         -b rc1a-vnj01ua1un60cv7t.mdb.yandexcloud.net:9091 \
         -t dds-service-orders \
         -X security.protocol=SASL_SSL \
         -X sasl.mechanism=SCRAM-SHA-512 \
         -X sasl.username="producer_consumer" \
         -X sasl.password="saxarok1" \
         -X ssl.ca.location=/home/saxarok/Desktop/CA.pem -Z -K:


stg
NULL:{"object_id": 2728074, "object_type": "order", "payload": {"id": 2728074, "date": "2023-09-28 18:45:41", "cost": 4265, "payment": 4265, "status": "CLOSED", "restaurant": {"id": "ef8c42c19b7518a9aebec106", "name": "\u0412\u043a\u0443\u0441 \u0418\u043d\u0434\u0438\u0438"}, "user": {"id": "626a81ce9a8cd1920641e2b4", "name": "\u0410\u043d\u0430\u0442\u043e\u043b\u0438\u0439 \u0411\u043e\u0440\u0438\u0441\u043b\u0430\u0432\u043e\u0432\u0438\u0447 \u041a\u043d\u044f\u0437\u0435\u0432", "login": "antonovaninel"}, "products": [{"id": "b551423ca4daabd9e219ee47", "price": 299, "quantity": 2, "name": "\u0422\u043e\u043c\u0430\u0442\u043d\u044b\u0439 \u0441\u0443\u043f", "category": "\u0421\u0443\u043f\u044b"}, {"id": "32ed48df80469389087c3e53", "price": 499, "quantity": 3, "name": "\u041f\u0430\u043b\u0430\u043a \u041f\u0430\u043d\u0438\u0440", "category": "\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0431\u043b\u044e\u0434\u0430"}, {"id": "55084ea193269b89bc1686c4", "price": 390, "quantity": 3, "name": "\u041c\u0430\u0448\u0440\u0443\u043c \u0422\u0438\u043a\u043a\u0430", "category": "\u0417\u0430\u043a\u0443\u0441\u043a\u0438"}, {"id": "7105441f860b1124a3a24fe9", "price": 250, "quantity": 4, "name": "\u0411\u0430\u043d\u0430\u043d\u0430 \u041b\u0430\u0441\u0441\u0438", "category": "\u041d\u0430\u043f\u0438\u0442\u043a\u0438"}]}}

order
NULL:{"object_id": 2745325, "object_type": "order", "sent_dttm": "2023-10-07 22:40:34", "payload": {"restaurant": {"id": "ef8c42c19b7518a9aebec106"}, "date": "2023-09-30 23:39:08", "user": {"id": "626a81ce9a8cd1920641e2ae"}, "order_items": [{"id": "927b4ba0b5494778ba576fd3", "name": "\u041c\u0438\u043a\u0441 \u0412\u0435\u0434\u0436 \u041f\u0430\u043a\u043e\u0440\u0430", "price": 450, "quantity": 1}, {"id": "800d4b1283e01fb243124225", "name": "\u0411\u0440\u0438\u0430\u043d\u0438 \u0441 \u043e\u0432\u043e\u0449\u0430\u043c\u0438", "price": 499, "quantity": 5}, {"id": "e2cf449a9a96e33881fe50a5", "name": "\u0414\u0430\u043b \u0422\u0430\u0440\u043a\u0430", "price": 390, "quantity": 2}, {"id": "2c0b49dd92d3e411f8f5fabd", "name": "\u0421\u043b\u0430\u0434\u043a\u0438\u0439 \u041b\u0430\u0441\u0441\u0438", "price": 150, "quantity": 1}, {"id": "95f74625be0428e4b2380310", "name": "\u041f\u0440\u043e\u0443\u043d \u041f\u0430\u043a\u043e\u0440\u0430", "price": 790, "quantity": 2}], "bonus_payment": 0, "cost": 5455, "payment": 5455, "bonus_grant": 0, "statuses": [{"status": "CLOSED", "dttm": "2023-09-30 23:39:08"}, {"status": "DELIVERING", "dttm": "2023-09-30 23:18:58"}, {"status": "COOKING", "dttm": "2023-09-30 22:36:01"}, {"status": "OPEN", "dttm": "2023-09-30 22:04:41"}], "final_status": "CLOSED", "update_ts": "2023-09-30 23:39:08"}}


---------------------------------------------------------------------------------------------------------------------------------
Для DDS:
в директории с dockerfile
sudo docker build . -t cr.yandex/crpum2q4frc77dsas1qd/dds-service:v2023-10-15-r1
sudo docker push cr.yandex/crpum2q4frc77dsas1qd/dds-service:v2023-10-15-r1

в директории с service_dds
helm upgrade --install --atomic dds-service app -n c14-stepan-starczev